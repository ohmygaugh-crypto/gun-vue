{"version":3,"file":"useGifts.es.js","sources":["../../../composables/src/gifts/useGifts.js"],"sourcesContent":["import { useNow } from '@vueuse/core'\nimport { SEA } from 'gun'\nimport { reactive, computed } from 'vue'\nimport { useGun, useUser, hashObj } from '..'\n\nexport const giftPath = \"#gifts2023\"\n\n\nexport function useGift() {\n  const { user } = useUser()\n  const gift = reactive({\n    from: computed(() => user?.pub),\n    to: '',\n    qn: 0,\n    ql: '',\n    wish: '',\n    date: useNow()\n  })\n\n  const gun = useGun()\n\n  async function propose() {\n\n    const { hash, hashed } = await hashObj(gift)\n\n    gun.get(giftPath).get(hash).put(hashed)\n\n    gun.user().get(giftPath).get(hash).put(true)\n\n  }\n\n  return { gift, propose }\n\n}\n\nexport async function acceptGift(hash) {\n  const { user } = useUser()\n  user.db.get(giftPath).get(hash).put(true)\n}\n\n\n\nexport function useGifts() {\n  const { user } = useUser()\n  const gun = useGun()\n\n  const my = reactive({})\n  const proposed = reactive({})\n  const gifts = reactive({})\n\n\n  gun.get(giftPath).map().once(async (d, k) => {\n    try {\n      const obj = JSON.parse(d)\n\n      obj.sent = await gun.user(obj.from).get(giftPath).get(k)\n      obj.received = await gun.user(obj.to).get(giftPath).get(k)\n\n      if (d.includes(user?.pub)) {\n        my[k] = obj\n      }\n\n      if (obj.sent) {\n        if (!obj.received)\n          proposed[k] = obj\n        else\n          gifts[k] = obj\n      }\n\n\n    } catch (e) {\n      // gifts[k] = d\n    }\n  })\n\n  return { my, proposed, gifts }\n}\n\n"],"names":[],"mappings":";;AAKY,MAAC,WAAW;AAGjB,mBAAmB;AACxB,QAAM,EAAE,SAAS,QAAS;AAC1B,QAAM,OAAO,SAAS;AAAA,IACpB,MAAM,SAAS,MAAM,6BAAM,GAAG;AAAA,IAC9B,IAAI;AAAA,IACJ,IAAI;AAAA,IACJ,IAAI;AAAA,IACJ,MAAM;AAAA,IACN,MAAM,OAAQ;AAAA,EAClB,CAAG;AAED,QAAM,MAAM,OAAQ;AAEpB,2BAAyB;AAEvB,UAAM,EAAE,MAAM,WAAW,MAAM,QAAQ,IAAI;AAE3C,QAAI,IAAI,QAAQ,EAAE,IAAI,IAAI,EAAE,IAAI,MAAM;AAEtC,QAAI,OAAO,IAAI,QAAQ,EAAE,IAAI,IAAI,EAAE,IAAI,IAAI;AAAA,EAE5C;AAED,SAAO,EAAE,MAAM,QAAS;AAE1B;AAEO,0BAA0B,MAAM;AACrC,QAAM,EAAE,SAAS,QAAS;AAC1B,OAAK,GAAG,IAAI,QAAQ,EAAE,IAAI,IAAI,EAAE,IAAI,IAAI;AAC1C;AAIO,oBAAoB;AACzB,QAAM,EAAE,SAAS,QAAS;AAC1B,QAAM,MAAM,OAAQ;AAEpB,QAAM,KAAK,SAAS,EAAE;AACtB,QAAM,WAAW,SAAS,EAAE;AAC5B,QAAM,QAAQ,SAAS,EAAE;AAGzB,MAAI,IAAI,QAAQ,EAAE,IAAK,EAAC,KAAK,OAAO,GAAG,MAAM;AAC3C,QAAI;AACF,YAAM,MAAM,KAAK,MAAM,CAAC;AAExB,UAAI,OAAO,MAAM,IAAI,KAAK,IAAI,IAAI,EAAE,IAAI,QAAQ,EAAE,IAAI,CAAC;AACvD,UAAI,WAAW,MAAM,IAAI,KAAK,IAAI,EAAE,EAAE,IAAI,QAAQ,EAAE,IAAI,CAAC;AAEzD,UAAI,EAAE,SAAS,6BAAM,GAAG,GAAG;AACzB,WAAG,KAAK;AAAA,MACT;AAED,UAAI,IAAI,MAAM;AACZ,YAAI,CAAC,IAAI;AACP,mBAAS,KAAK;AAAA;AAEd,gBAAM,KAAK;AAAA,MACd;AAAA,IAGF,SAAQ,GAAP;AAAA,IAED;AAAA,EACL,CAAG;AAED,SAAO,EAAE,IAAI,UAAU,MAAO;AAChC;;"}