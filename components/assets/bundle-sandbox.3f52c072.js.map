{"version":3,"file":"bundle-sandbox.3f52c072.js","sources":["../../../../node_modules/.pnpm/histoire@0.7.9_vite@2.9.13/node_modules/histoire/dist/bundled/sandbox.js"],"sourcesContent":["import { parseQuery } from \"vue-router\";\nimport { reactive, ref, createApp, computed, watch, onMounted, h } from \"vue\";\nimport { createPinia } from \"pinia\";\nimport { applyStateToVariant } from \"@histoire/shared\";\nimport { MountStoryVue3, SandboxVue3 } from \"@histoire/plugin-vue/client\";\nimport { m as mapFile } from \"./mapping.js\";\nimport { files } from \"$histoire-stories\";\nimport { S as STATE_SYNC, P as PREVIEW_SETTINGS_SYNC, a as SANDBOX_READY } from \"./const.js\";\nimport { i as isDark } from \"./dark.js\";\nimport { h as histoireConfig } from \"./config.js\";\nimport { t as toRawDeep } from \"./state.js\";\nconst receivedSettings = reactive({});\nfunction applyPreviewSettings(settings) {\n  Object.assign(receivedSettings, settings);\n}\nconst query = parseQuery(window.location.search);\nconst file = ref(mapFile(files.find((f) => f.id === query.storyId)));\nconst app = createApp({\n  name: \"SandboxApp\",\n  setup() {\n    const story = computed(() => file.value.story);\n    const variant = computed(() => {\n      var _a;\n      return (_a = story.value) == null ? void 0 : _a.variants.find((v) => v.id === query.variantId);\n    });\n    let synced = false;\n    let mounted = false;\n    window.addEventListener(\"message\", (event) => {\n      var _a, _b;\n      if (((_a = event.data) == null ? void 0 : _a.type) === STATE_SYNC) {\n        if (!mounted)\n          return;\n        synced = true;\n        applyStateToVariant(variant.value, event.data.state);\n      } else if (((_b = event.data) == null ? void 0 : _b.type) === PREVIEW_SETTINGS_SYNC) {\n        applyPreviewSettings(event.data.settings);\n      }\n    });\n    watch(() => variant.value.state, (value) => {\n      var _a;\n      if (synced && mounted) {\n        synced = false;\n        return;\n      }\n      (_a = window.parent) == null ? void 0 : _a.postMessage({\n        type: STATE_SYNC,\n        state: toRawDeep(value)\n      });\n    }, {\n      deep: true\n    });\n    onMounted(() => {\n      mounted = true;\n    });\n    return {\n      story,\n      variant\n    };\n  },\n  render() {\n    return [\n      h(\"div\", { class: \"htw-sandbox-hidden\" }, [\n        h(MountStoryVue3, {\n          story: file.value.story\n        })\n      ]),\n      this.story && this.variant ? h(SandboxVue3, {\n        story: this.story,\n        variant: this.variant,\n        onReady: () => {\n          var _a;\n          (_a = window.parent) == null ? void 0 : _a.postMessage({\n            type: SANDBOX_READY\n          });\n        }\n      }) : null\n    ];\n  }\n});\napp.use(createPinia());\napp.mount(\"#app\");\nwatch(isDark, (value) => {\n  if (value) {\n    document.documentElement.classList.add(histoireConfig.sandboxDarkClass);\n  } else {\n    document.documentElement.classList.remove(histoireConfig.sandboxDarkClass);\n  }\n}, {\n  immediate: true\n});\n"],"names":["MountStoryVue3","SandboxVue3"],"mappings":";;;;AAWA,MAAM,mBAAmB,SAAS,CAAA,CAAE;AACpC,8BAA8B,UAAU;AACtC,SAAO,OAAO,kBAAkB,QAAQ;AAC1C;AACA,MAAM,QAAQ,WAAW,OAAO,SAAS,MAAM;AAC/C,MAAM,OAAO,IAAI,QAAQ,MAAM,KAAK,CAAC,MAAM,EAAE,OAAO,MAAM,OAAO,CAAC,CAAC;AACnE,MAAM,MAAM,UAAU;AAAA,EACpB,MAAM;AAAA,EACN,QAAQ;AACN,UAAM,QAAQ,SAAS,MAAM,KAAK,MAAM,KAAK;AAC7C,UAAM,UAAU,SAAS,MAAM;AAC7B,UAAI;AACJ,aAAQ,MAAK,MAAM,UAAU,OAAO,SAAS,GAAG,SAAS,KAAK,CAAC,MAAM,EAAE,OAAO,MAAM,SAAS;AAAA,IACnG,CAAK;AACD,QAAI,SAAS;AACb,QAAI,UAAU;AACd,WAAO,iBAAiB,WAAW,CAAC,UAAU;AAC5C,UAAI,IAAI;AACR,UAAM,OAAK,MAAM,SAAS,OAAO,SAAS,GAAG,UAAU,YAAY;AACjE,YAAI,CAAC;AACH;AACF,iBAAS;AACT,4BAAoB,QAAQ,OAAO,MAAM,KAAK,KAAK;AAAA,MACpD,WAAY,OAAK,MAAM,SAAS,OAAO,SAAS,GAAG,UAAU,uBAAuB;AACnF,6BAAqB,MAAM,KAAK,QAAQ;AAAA,MACzC;AAAA,IACP,CAAK;AACD,UAAM,MAAM,QAAQ,MAAM,OAAO,CAAC,UAAU;AAC1C,UAAI;AACJ,UAAI,UAAU,SAAS;AACrB,iBAAS;AACT;AAAA,MACD;AACD,MAAC,MAAK,OAAO,WAAW,OAAO,SAAS,GAAG,YAAY;AAAA,QACrD,MAAM;AAAA,QACN,OAAO,UAAU,KAAK;AAAA,MAC9B,CAAO;AAAA,IACP,GAAO;AAAA,MACD,MAAM;AAAA,IACZ,CAAK;AACD,cAAU,MAAM;AACd,gBAAU;AAAA,IAChB,CAAK;AACD,WAAO;AAAA,MACL;AAAA,MACA;AAAA,IACN;AAAA,EACG;AAAA,EACD,SAAS;AACP,WAAO;AAAA,MACL,EAAE,OAAO,EAAE,OAAO,qBAAoB,GAAI;AAAA,QACxC,EAAEA,WAAgB;AAAA,UAChB,OAAO,KAAK,MAAM;AAAA,QAC5B,CAAS;AAAA,MACT,CAAO;AAAA,MACD,KAAK,SAAS,KAAK,UAAU,EAAEC,aAAa;AAAA,QAC1C,OAAO,KAAK;AAAA,QACZ,SAAS,KAAK;AAAA,QACd,SAAS,MAAM;AACb,cAAI;AACJ,UAAC,MAAK,OAAO,WAAW,OAAO,SAAS,GAAG,YAAY;AAAA,YACrD,MAAM;AAAA,UAClB,CAAW;AAAA,QACF;AAAA,MACF,CAAA,IAAI;AAAA,IACX;AAAA,EACG;AACH,CAAC;AACD,IAAI,IAAI,YAAW,CAAE;AACrB,IAAI,MAAM,MAAM;AAChB,MAAM,QAAQ,CAAC,UAAU;AACvB,MAAI,OAAO;AACT,aAAS,gBAAgB,UAAU,IAAI,eAAe,gBAAgB;AAAA,EAC1E,OAAS;AACL,aAAS,gBAAgB,UAAU,OAAO,eAAe,gBAAgB;AAAA,EAC1E;AACH,GAAG;AAAA,EACD,WAAW;AACb,CAAC;"}